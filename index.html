<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Solicita√ß√£o de Reembolso - Sem Fronteiras</title>
  <link rel="manifest" href="manifest.json" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background-color: #f7f9fb; margin: 0; padding: 0; }
    .container {
        width: 95%;
        max-width: 800px;
        background-color: #fff;
        margin: 20px auto;
        padding: 30px 50px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        box-sizing: border-box;
    }
    .header { text-align: center; padding: 15px 0; }
    .header img { max-height: 80px; width: auto; }
    .titulo { text-align: center; background-color: #1c6ba0; color: white; font-weight: bold; padding: 10px; border-radius: 4px; margin: 25px 0 30px 0; font-size: 20px; }
    label { font-weight: bold; }
    input, textarea, select { width: 100%; padding: 6px; margin-top: 4px; margin-bottom: 12px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; background-color: #fff; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { border: none; padding: 12px 8px; text-align: center; vertical-align: middle; border-bottom: 1px solid #eee; }
    th { background-color: transparent; border-bottom: 2px solid #1c6ba0; font-weight: bold; }
    .add-row { background-color: #0072bb; color: #fff; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; margin-top: 10px; }
    .remove-row { color: red; cursor: pointer; font-weight: bold; user-select: none; }
    .total { text-align: right; font-weight: bold; font-size: 1.1em; margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee; }
    .comprovante-container { display: flex; align-items: center; margin-top: 30px; padding: 10px; border: 1px solid #ddd; border-radius: 6px; flex-wrap: wrap; }
    .comprovante-actions { display: flex; align-items: center; flex-wrap: wrap; gap: 8px; }
    .comprovante-actions strong { font-size: 1em; margin-right: 15px; }
    .anexo-btn { background-color:#0072bb; color:white; border: none; padding: 8px 12px; font-size: 0.9em; border-radius:4px; cursor:pointer; margin: 0 5px; white-space: nowrap; }
    #lista-comprovantes { display: flex; flex-wrap: wrap; gap: 8px; margin-left: 15px; align-items: center; }
    .arquivo-item { background-color: #e9ecef; padding: 4px 8px; border-radius: 4px; font-size: 0.85em; display: flex; align-items: center; }
    .remove-arquivo { margin-left: 8px; color: #d9534f; font-weight: bold; cursor: pointer; }
    .assinaturas-container { display: flex; justify-content: space-around; align-items: flex-start; margin-top: 40px; gap: 30px; }
    .assinatura-bloco { flex: 1; text-align: center; }
    .assinatura { margin-top: 0; text-align: center; }
    #signature-pad { border: 2px solid #ccc; border-radius: 6px; width: 100%; max-width: 300px; height: 120px; margin: 0 auto; background-color: #fafafa; cursor: crosshair; touch-action: none; }
    .assinatura-btns button { background-color: #0072bb; color: white; border: none; padding: 5px 10px; margin: 2px; border-radius: 4px; cursor: pointer; }
    .assinatura-line { border-top: 1px solid #000; width: 100%; max-width: 300px; margin: 135px auto 0 auto; }
    #supervisorNome { display: block; width: 100%; max-width: 300px; margin: 8px auto 0 auto; text-align: center; }
    .btn-submit { background-color: #5cb85c; color: white; }
    .btn-secondary { background-color: #0072bb; color: white; margin-right: 10px; }
    .btn-danger { background-color: #d9534f; color: white; }
    .btn-submit, .btn-secondary, .btn-danger { border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-top: 20px; }
    .btn-submit:disabled { background-color: #94d394; cursor: not-allowed; }
    .pix-group { display: flex; gap: 15px; flex-wrap: wrap; }
    
    .modal-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background-color: rgba(0,0,0,0.5); z-index: 100; display: none;
    }
    .modal {
        position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
        background-color: white; padding: 25px; border-radius: 8px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index: 101; display: none;
        width: 90%; max-width: 350px; text-align: center;
    }
    .modal p { margin-top: 0; font-weight: bold; font-size: 1.1em; }
    .modal button { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 5px; border: 1px solid #ccc; background-color: #f0f0f0; cursor: pointer; font-size: 1em; }
    .modal button.btn-danger { background-color: #d9534f; color: white; border: none; }

    @media (max-width: 768px) {
        .container { width: 100%; margin: 0; padding: 15px; border-radius: 0; box-shadow: none; }
        .pix-group, .assinaturas-container { flex-direction: column; gap: 20px; }
        .assinatura-bloco { width: 100%; max-width: 350px; margin: 0 auto; }
        .assinatura-line { margin-top: 40px; }
        .header img { max-height: 60px; }
        .titulo { font-size: 18px; }
        .comprovante-container { flex-direction: column; align-items: flex-start; gap: 15px; }
        #lista-comprovantes { margin-left: 0; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header"> <img src="https://i.imgur.com/dvzRyus.png" alt="Sem Fronteiras Logo"> </div>
    <div class="titulo">Solicita√ß√£o de Reembolso</div>
    <label for="nomeSolicitante">Nome do solicitante:</label>
    <input type="text" id="nomeSolicitante" placeholder="Digite o nome completo" autocapitalize="words">
    <p>Venho por meio deste solicitar o reembolso das despesas informadas abaixo:</p>
    <table id="tabelaDespesas">
      <thead>
        <tr>
          <th style="width: 20%;">Data</th>
          <th style="width: 50%;">Descri√ß√£o da Despesa</th>
          <th style="width: 25%;">Valor (R$)</th>
          <th style="width: 5%;"></th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <button class="add-row" type="button" onclick="adicionarLinha()">+ Adicionar despesa</button>
    <div class="total">Total a Reembolsar: R$ <span id="total">0,00</span></div>
    <h3>Dados para transfer√™ncia via Pix:</h3>
    <div class="pix-group">
        <div><label for="tipoPix">Tipo de Chave Pix:</label><select id="tipoPix" onchange="configurarInputPix()"><option value="cpf_cnpj">CPF/CNPJ</option><option value="celular">Celular (DD + N√∫mero)</option><option value="email">E-mail</option><option value="aleatoria">Chave Aleat√≥ria</option></select></div>
        <div><label for="chavePixInput">Chave Pix:</label><input type="text" id="chavePixInput" placeholder="Digite o CPF ou CNPJ" /></div>
    </div>

    <div class="comprovante-container">
      <div class="comprovante-actions">
          <strong>Comprovantes:</strong>
          <button class="anexo-btn" onclick="inserirComprovante()">Inserir Comprovante(s)</button>
      </div>
      <div id="lista-comprovantes"></div>
    </div>

    <div class="assinaturas-container">
        <div class="assinatura-bloco">
            <div class="assinatura">
                <p><strong>Assinatura Digital do Solicitante:</strong></p>
                <canvas id="signature-pad"></canvas>
                <div class="assinatura-btns">
                  <button type="button" onclick="limparAssinatura()">Limpar</button>
                </div>
            </div>
        </div>
        <div class="assinatura-bloco">
            <div class="assinatura">
                <p><strong>Assinatura do Supervisor:</strong></p> 
                <div class="assinatura-line"></div>
                <input type="text" id="supervisorNome" placeholder="Nome do Supervisor por Extenso" autocapitalize="words" />
            </div>
        </div>
    </div>

    <div style="text-align:center;">
      <button class="btn-secondary" onclick="gerarPDF()">Gerar PDF Local</button>
      <button id="submit-btn" class="btn-submit" onclick="enviarParaAprovacao()">Enviar para Aprova√ß√£o</button>
      <button class="btn-danger" onclick="limparFormulario()">Limpar Formul√°rio</button>
    </div>
  </div>

  <div id="comprovante-modal-overlay" class="modal-overlay" onclick="fecharModalComprovante()"></div>
  <div id="comprovante-modal" class="modal">
    <p>Adicionar comprovante</p>
    <button onclick="escolherOpcaoComprovante('camera')">üì∑ Abrir C√¢mera</button>
    <button onclick="escolherOpcaoComprovante('arquivo')">üìÅ Procurar Arquivos</button>
    <button class="btn-danger" onclick="fecharModalComprovante()">Cancelar</button>
  </div>

  <script>
    // ‚ñº‚ñº‚ñº ADICIONE SUA URL DO APPS SCRIPT AQUI ‚ñº‚ñº‚ñº
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz5lB9jL3giT0yTCjnzchZUqjiDrQ93bpjZ3Rmupvwp8WhdGOsGc6XFFt2V1xhx_8I5/exec';
    // ‚ñ≤‚ñ≤‚ñ≤ ‚ñ≤‚ñ≤‚ñ≤ ‚ñ≤‚ñ≤‚ñ≤ ‚ñ≤‚ñ≤‚ñ≤ ‚ñ≤‚ñ≤‚ñ≤ ‚ñ≤‚ñ≤‚ñ≤ ‚ñ≤‚ñ≤‚ñ≤ ‚ñ≤‚ñ≤‚ñ≤ ‚ñ≤‚ñ≤‚ñ≤ ‚ñ≤‚ñ≤‚ñ≤ ‚ñ≤‚ñ≤‚ñ≤

    let signatureCanvas, signatureCtx, signatureDrawing = false;
    let comprovantes = [];
    const regexEmail = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
    const hoje = new Date();
    const dia = String(hoje.getDate()).padStart(2, '0');
    const mes = String(hoje.getMonth() + 1).padStart(2, '0');
    const ano = hoje.getFullYear();
    const dataMaxima = `${ano}-${mes}-${dia}`;

    async function enviarParaAprovacao() {
      if (!validarFormulario()) { return; }

      const submitBtn = document.getElementById('submit-btn');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Enviando...';

      try {
        const tipoPixSelect = document.getElementById("tipoPix");
        const despesas = [];
        document.querySelectorAll('#tabelaDespesas tbody tr').forEach(row => {
            const dataInput = row.querySelector('input[type="date"]');
            const descricaoInput = row.querySelector('input[type="text"]');
            const valorInput = row.querySelector('input[type="number"]');
            if (dataInput && descricaoInput && valorInput && (dataInput.value || descricaoInput.value || valorInput.value)) {
                despesas.push({
                    data: dataInput.value ? dataInput.value.split('-').reverse().join('/') : '',
                    descricao: descricaoInput.value,
                    valor: parseFloat(valorInput.value || 0).toFixed(2)
                });
            }
        });

        const dadosParaEnviar = {
          nomeSolicitante: document.getElementById('nomeSolicitante').value,
          despesas: despesas,
          valorTotal: document.getElementById('total').textContent,
          tipoChavePix: tipoPixSelect.options[tipoPixSelect.selectedIndex].text,
          chavePix: document.getElementById('chavePixInput').value,
          nomeSupervisor: document.getElementById('supervisorNome').value,
          assinaturaImg: signatureCanvas.toDataURL('image/png'),
          comprovantes: comprovantes
        };

        const response = await fetch(APPS_SCRIPT_URL, {
          method: 'POST',
          body: JSON.stringify(dadosParaEnviar),
          headers: { 'Content-Type': 'text/plain;charset=utf-8' }
        });

        const result = await response.json();

        if (result.status === 'sucesso') {
          alert('Solicita√ß√£o enviada com sucesso!\nProtocolo: ' + result.protocolo);
          limparFormulario(true);
        } else {
          throw new Error(result.mensagem);
        }

      } catch (error) {
        console.error("Erro ao enviar solicita√ß√£o:", error);
        alert('Falha ao enviar a solicita√ß√£o. Verifique sua conex√£o ou tente novamente mais tarde.\nErro: ' + error.message);
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Enviar para Aprova√ß√£o';
      }
    }

    function validarFormulario() {
        const nome = document.getElementById("nomeSolicitante").value.trim();
        if (nome === "") { alert("Por favor, preencha o nome do solicitante."); return false; }
        
        let despesaPreenchida = false;
        document.querySelectorAll('#tabelaDespesas tbody tr').forEach((linha) => {
            const descricao = linha.querySelector('input[type="text"]').value.trim();
            const valor = linha.querySelector('input[type="number"]').value.trim();
            if(descricao || valor) despesaPreenchida = true;
        });
        if (!despesaPreenchida) { alert("Adicione pelo menos uma despesa."); return false; }
        
        const pix = document.getElementById("chavePixInput").value.trim();
        if (pix === "") { alert("Por favor, preencha a chave Pix."); return false; }

        if (comprovantes.length === 0) {
            alert("Por favor, anexe pelo menos um comprovante antes de continuar.");
            return false;
        }

        if (!signatureCanvas.getContext('2d').getImageData(0, 0, signatureCanvas.width, signatureCanvas.height).data.some(channel => channel !== 0)) {
            alert("A assinatura do solicitante √© obrigat√≥ria.");
            return false;
        }
        
        return true;
    }
    
    function capitalizarNomeProprio(nome) { if (!nome) return ''; const excecoes = ['e', 'de', 'da', 'do', 'das', 'dos']; return nome.toLowerCase().split(' ').map((palavra, index) => { if (index > 0 && excecoes.includes(palavra)) { return palavra; } return palavra.charAt(0).toUpperCase() + palavra.slice(1); }).join(' '); }
    
    async function gerarPDF() { if (!validarFormulario()) { return; } try { const logoUrl = 'https://i.imgur.com/dvzRyus.png'; const logoBase64 = await getImageBase64(logoUrl); const nome = document.getElementById("nomeSolicitante").value; const tipoPixSelect = document.getElementById("tipoPix"); const tipoPix = tipoPixSelect.options[tipoPixSelect.selectedIndex].text; const chavePix = document.getElementById("chavePixInput").value; const supervisor = document.getElementById("supervisorNome").value; const total = document.getElementById("total").textContent; const assinaturaImg = signatureCanvas.toDataURL('image/png'); const despesas = []; document.querySelectorAll('#tabelaDespesas tbody tr').forEach(row => { const dataInput = row.querySelector('input[type="date"]'); const descricaoInput = row.querySelector('input[type="text"]'); const valorInput = row.querySelector('input[type="number"]'); if (dataInput && descricaoInput && valorInput && (dataInput.value || descricaoInput.value || valorInput.value)) { despesas.push({ data: dataInput.value ? dataInput.value.split('-').reverse().join('/') : '', descricao: descricaoInput.value, valor: parseFloat(valorInput.value || 0).toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) }); } }); const { jsPDF } = window.jspdf; const pdf = new jsPDF('p', 'mm', 'a4'); const pageWidth = pdf.internal.pageSize.getWidth(); const margin = 15; let y = 15; const logoWidth = 50; const logoX = (pageWidth - logoWidth) / 2; pdf.addImage(logoBase64, 'PNG', logoX, y, logoWidth, 12); y += 25; pdf.setFontSize(18); pdf.setFont(undefined, 'bold'); pdf.text("Solicita√ß√£o de Reembolso", pageWidth / 2, y, { align: 'center' }); y += 15; pdf.setFontSize(11); pdf.setFont(undefined, 'normal'); const labelNome = "Nome do solicitante: "; const labelNomeWidth = pdf.getTextWidth(labelNome); pdf.text(labelNome, margin, y); pdf.setFont(undefined, 'bold'); pdf.text(nome, margin + labelNomeWidth, y); pdf.setFont(undefined, 'normal'); y += 7; const introLines = pdf.splitTextToSize("Venho por meio deste solicitar o reembolso das despesas informadas abaixo:", pageWidth - (margin * 2)); pdf.text(introLines, margin, y); y += (introLines.length * 5) + 5; pdf.setFont(undefined, 'bold'); pdf.text("Data", margin, y); pdf.text("Descri√ß√£o da Despesa", margin + 30, y); pdf.text("Valor (R$)", pageWidth - margin, y, { align: 'right' }); y += 2; pdf.line(margin, y, pageWidth - margin, y); y += 5; pdf.setFont(undefined, 'bold'); despesas.forEach(d => { const descLines = pdf.splitTextToSize(d.descricao, 110); const rowHeight = (descLines.length * 5) + 3; if (y + rowHeight > 270) { pdf.addPage(); y = 20; } const textY = y + (rowHeight / 2) - 2; pdf.text(d.data, margin, textY); pdf.text(descLines, margin + 30, y); pdf.text(d.valor, pageWidth - margin, textY, { align: 'right' }); y += rowHeight; }); pdf.setFont(undefined, 'normal'); y += 5; pdf.setFont(undefined, 'bold'); pdf.text(`Total a Reembolsar: R$ ${total}`, pageWidth - margin, y, { align: 'right' }); y += 15; pdf.setFont(undefined, 'bold'); pdf.text("Dados para transfer√™ncia via Pix:", margin, y); y += 7; pdf.setFont(undefined, 'normal'); const col1X = margin; const col2X = pageWidth / 2; pdf.text(`Tipo de Chave: ${tipoPix}`, col1X, y); pdf.text(`Chave: ${chavePix}`, col2X, y); let signatureY = y + 25; if (signatureY > 220) { pdf.addPage(); signatureY = 30; } const signatureWidth = 70; const signatureCenterX = (pageWidth - signatureWidth) / 2; pdf.addImage(assinaturaImg, 'PNG', signatureCenterX, signatureY, signatureWidth, 25); pdf.line(signatureCenterX, signatureY + 26, signatureCenterX + signatureWidth, signatureY + 26); pdf.setFont(undefined, 'bold'); pdf.text("Assinatura do Solicitante", pageWidth / 2, signatureY + 31, { align: 'center' }); signatureY += 45; pdf.line(signatureCenterX, signatureY + 26, signatureCenterX + signatureWidth, signatureY + 26); pdf.text(supervisor || "Assinatura do Supervisor", pageWidth / 2, signatureY + 31, { align: 'center', fontStyle: 'bold' }); comprovantes.forEach((comprovante, index) => { pdf.addPage(); const title = `Comprovante ${index + 1}`; const imgProps = pdf.getImageProperties(comprovante.src); const innerMargin = 15; const maxWidth = pdf.internal.pageSize.getWidth() - innerMargin * 2; const maxHeight = pdf.internal.pageSize.getHeight() - innerMargin * 2 - 20; const ratio = Math.min(maxWidth / imgProps.width, maxHeight / imgProps.height); const w = imgProps.width * ratio; const h = imgProps.height * ratio; const x = (pdf.internal.pageSize.getWidth() - w) / 2; const y_img = (pdf.internal.pageSize.getHeight() - h) / 2 + 10; pdf.setFontSize(12); pdf.text(title, pdf.internal.pageSize.getWidth() / 2, innerMargin, { align: 'center' }); pdf.addImage(comprovante.src, 'PNG', x, y_img, w, h); }); pdf.save(`reembolso_${nome.replace(/\s+/g, '_')}.pdf`); } catch (error) { console.error("Erro ao gerar PDF:", error); alert("N√£o foi poss√≠vel gerar o PDF. Verifique sua conex√£o com a internet e tente novamente."); } }
    function getImageBase64(url) { return new Promise((resolve, reject) => { const img = new Image(); img.crossOrigin = 'Anonymous'; img.onload = () => { const canvas = document.createElement('canvas'); canvas.width = img.width; canvas.height = img.height; const ctx = canvas.getContext('2d'); ctx.drawImage(img, 0, 0); resolve(canvas.toDataURL('image/png')); }; img.onerror = reject; img.src = url; }); }
    const modal = document.getElementById('comprovante-modal'); const overlay = document.getElementById('comprovante-modal-overlay');
    function inserirComprovante() { modal.style.display = 'block'; overlay.style.display = 'block'; }
    function fecharModalComprovante() { modal.style.display = 'none'; overlay.style.display = 'none'; }
    function escolherOpcaoComprovante(tipo) { const input = document.createElement('input'); input.type = 'file'; input.accept = 'image/jpeg,image/png'; if (tipo === 'camera') { input.setAttribute('capture', 'environment'); } else { input.multiple = true; } input.onchange = e => { const files = e.target.files; if (!files.length) return; for (const file of files) { const reader = new FileReader(); reader.onload = function(event) { comprovantes.push({ filename: file.name, src: event.target.result }); renderizarComprovantes(); }; reader.readAsDataURL(file); } }; input.click(); fecharModalComprovante(); }
    function renderizarComprovantes() { const listaArea = document.getElementById('lista-comprovantes'); listaArea.innerHTML = ''; comprovantes.forEach((comprovante, index) => { const item = document.createElement('div'); item.className = 'arquivo-item'; const nomeArquivo = document.createElement('span'); nomeArquivo.textContent = comprovante.filename; const removeBtn = document.createElement('span'); removeBtn.className = 'remove-arquivo'; removeBtn.innerHTML = '&times;'; removeBtn.onclick = function() { removerComprovante(index); }; item.appendChild(nomeArquivo); item.appendChild(removeBtn); listaArea.appendChild(item); }); }
    function removerComprovante(index) { comprovantes.splice(index, 1); renderizarComprovantes(); }
    function limparFormulario(forcar = false) { if (forcar || confirm("Tem certeza de que deseja limpar todos os campos do formul√°rio?")) { document.getElementById('nomeSolicitante').value = ''; document.getElementById('supervisorNome').value = ''; document.querySelector('#tabelaDespesas tbody').innerHTML = ''; adicionarLinha(); comprovantes = []; renderizarComprovantes(); document.getElementById('tipoPix').value = 'cpf_cnpj'; configurarInputPix(); limparAssinatura(); window.scrollTo({ top: 0, behavior: 'smooth' }); } }
    function adicionarLinha() { const tabelaBody = document.getElementById("tabelaDespesas").getElementsByTagName("tbody")[0]; const novaLinha = document.createElement("tr"); novaLinha.innerHTML = `<td><input type="date" max="${dataMaxima}" /></td><td><input type="text" class="descricao-despesa" placeholder="Descreva a despesa" /></td><td><input type="number" class="valor" step="0.01" min="0" placeholder="0.00" /></td><td><span class="remove-row" title="Remover linha">‚úñ</span></td>`; tabelaBody.appendChild(novaLinha); atualizarEventos(); }
    function atualizarEventos() { document.querySelectorAll(".valor").forEach(input => { input.oninput = calcularTotal; input.onblur = function() { const valor = parseFloat(this.value); if (!isNaN(valor)) { this.value = valor.toFixed(2); } }; }); document.querySelectorAll(".remove-row").forEach(btn => { btn.onclick = function() { this.closest("tr").remove(); calcularTotal(); }; }); document.querySelectorAll(".descricao-despesa").forEach(input => { input.oninput = function() { this.value = this.value.split(' ').map(word => { return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase(); }).join(' '); }; }); calcularTotal(); }
    function configurarInputPix() { const tipo = document.getElementById("tipoPix").value; const input = document.getElementById("chavePixInput"); input.oninput = null; input.value = ""; input.setAttribute("type", "text"); input.removeAttribute("maxlength"); input.removeAttribute("inputmode"); switch (tipo) { case 'cpf_cnpj': input.setAttribute("placeholder", "Digite o CPF ou CNPJ"); input.setAttribute("inputmode", "numeric"); input.setAttribute("maxlength", "18"); input.oninput = function() { let value = this.value.replace(/\D/g, ''); if (value.length > 14) value = value.substring(0, 14); if (value.length <= 11) { value = value.replace(/(\d{3})(\d)/, '$1.$2'); value = value.replace(/(\d{3})(\d)/, '$1.$2'); value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2'); } else { value = value.replace(/^(\d{2})(\d)/, '$1.$2'); value = value.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3'); value = value.replace(/\.(\d{3})(\d)/, '.$1/$2'); value = value.replace(/(\d{4})(\d)/, '$1-$2'); } this.value = value; }; break; case 'celular': input.setAttribute("placeholder", "Ex: (99) 98765-4321"); input.setAttribute("type", "tel"); break; case 'email': input.setAttribute("placeholder", "Ex: seu.email@dominio.com"); input.setAttribute("type", "email"); break; case 'aleatoria': input.setAttribute("placeholder", "Digite a chave"); break; } }
    function calcularTotal() { let total = 0; document.querySelectorAll(".valor").forEach(input => { const val = parseFloat(input.value); if (!isNaN(val)) total += val; }); document.getElementById("total").textContent = total.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }); }
    function setupSignature() { signatureCanvas = document.getElementById("signature-pad"); if (!signatureCanvas) return; signatureCtx = signatureCanvas.getContext("2d"); signatureDrawing = false; signatureCanvas.addEventListener("mousedown", e => { signatureDrawing = true; signatureCtx.beginPath(); signatureCtx.moveTo(e.offsetX, e.offsetY); }); signatureCanvas.addEventListener("mousemove", e => { if (signatureDrawing) { signatureCtx.lineTo(e.offsetX, e.offsetY); signatureCtx.stroke(); } }); signatureCanvas.addEventListener("mouseup", () => signatureDrawing = false); signatureCanvas.addEventListener("mouseleave", () => signatureDrawing = false); signatureCanvas.addEventListener("touchstart", e => { e.preventDefault(); const touch = e.touches[0]; signatureDrawing = true; signatureCtx.beginPath(); signatureCtx.moveTo(touch.clientX - signatureCanvas.getBoundingClientRect().left, touch.clientY - signatureCanvas.getBoundingClientRect().top); }); signatureCanvas.addEventListener("touchmove", e => { e.preventDefault(); if (signatureDrawing) { const touch = e.touches[0]; signatureCtx.lineTo(touch.clientX - signatureCanvas.getBoundingClientRect().left, touch.clientY - signatureCanvas.getBoundingClientRect().top); signatureCtx.stroke(); } }); signatureCanvas.addEventListener("touchend", () => signatureDrawing = false); }
    function limparAssinatura() { if (signatureCtx && signatureCanvas) { signatureCtx.clearRect(0, 0, signatureCanvas.width, signatureCanvas.height); } }
    
    document.addEventListener("DOMContentLoaded", () => {
      adicionarLinha();
      setupSignature();
      configurarInputPix();
      const nomeSolicitanteInput = document.getElementById('nomeSolicitante');
      const supervisorNomeInput = document.getElementById('supervisorNome');
      nomeSolicitanteInput.addEventListener('input', function() { this.value = capitalizarNomeProprio(this.value); });
      supervisorNomeInput.addEventListener('input', function() { this.value = capitalizarNomeProprio(this.value); });
      
      // ‚ñº‚ñº‚ñº C√ìDIGO REINSERIDO PARA FUNCIONALIDADE OFFLINE (PWA) ‚ñº‚ñº‚ñº
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('./sw.js')
            .then(registration => {
              console.log('ServiceWorker registrado com sucesso:', registration.scope);
            })
            .catch(error => {
              console.log('Falha no registro do ServiceWorker:', error);
            });
        });
      }
      // ‚ñ≤‚ñ≤‚ñ≤ FIM DO BLOCO REINSERIDO ‚ñ≤‚ñ≤‚ñ≤
    });
  </script>
</body>
</html>